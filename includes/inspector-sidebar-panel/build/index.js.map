{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"plugins\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"editor\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"element\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"data\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"coreData\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"i18n\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"components\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window \"prcHooks\"","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window \"prcComponents\"","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"blockEditor\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window [\"wp\",\"blocks\"]","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window \"ReactJSXRuntime\"","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/../../shared/citation.jsx","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/./src/datacite-doi-schema-panel.jsx","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/external window \"prcIcons\"","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/../../shared/icon.jsx","webpack://@pewresearch/prc-platform-schema-academic-identity-inspector-sidebar-panel/./src/index.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"plugins\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"editor\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"data\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"coreData\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"components\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"prcHooks\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"prcComponents\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blockEditor\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"blocks\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"ReactJSXRuntime\"];","/**\n * WordPress Dependencies\n */\nimport {\n\tRichText,\n} from '@wordpress/block-editor';\nimport { TextControl } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\n\nconst DOI_CITATION_REGEX = /(https:\\/\\/doi\\.org\\/)?(\\d{2}\\.\\d{5}\\/[A-Za-z0-9-]+)/;\n\nconst isValidJSON = (str) => {\n\ttry {\n\t\tJSON.parse(str);\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n\nconst extractDoiCitation = (value) => {\n\tconsole.log('extractedCitation in:', value);\n\tif (value && typeof value === 'string' && isValidJSON(value)) {\n\t\ttry {\n\t\t\tvalue = JSON.parse(value);\n\t\t} catch (e) {\n\t\t\tconsole.error('Failed to parse DOI JSON:', e);\n\t\t\treturn null;\n\t\t}\n\t} else {\n\t\tconsole.warn('Invalid JSON provided for DOI citation');\n\t\treturn null;\n\t}\n\t// Check if data is a valid property of the object\n\tconsole.log('passed...', value);\n\tif (value && value['@id']) {\n\t\t// Check if the data.id is a valid DOI citation\n\t\tif (DOI_CITATION_REGEX.test(value['@id'])) {\n\t\t\t// Then extract the DOI citation\n\t\t\treturn value['@id'].match(DOI_CITATION_REGEX)[2];\n\t\t}\n\t}\n\tconsole.log('passed...', value.data);\n\tif (value && value.data.id) {\n\t\tif (DOI_CITATION_REGEX.test(value.data.id)) {\n\t\t\t// Then extract the DOI citation\n\t\t\treturn value.data.id.match(DOI_CITATION_REGEX)[2];\n\t\t}\n\t}\n\treturn null;\n};\n\nfunction Citation({\n\tdate = '2025',\n\ttitle = 'Title of the Article',\n\tdoiCitation = 'XX.XXX/XXXXX',\n\tallowEditing = false,\n\teditingAsRichText = false,\n\tonChange = () => {},\n}) {\n\tconst t = sprintf(`\"%s\"`, title);\n\treturn(\n\t\t<p>\n\t\t\t<span>Doe, John. {date}. {t}. Pew Research Center. doi:</span>\n\t\t\t{' '}\n\t\t\t{ !allowEditing ? (\n\t\t\t\t<span>\n\t\t\t\t\t<a href={`https://doi.org/${doiCitation}`}>{doiCitation}</a>\n\t\t\t\t</span>\n\t\t\t) : (\n\t\t\t\teditingAsRichText ? (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"span\"\n\t\t\t\t\t\tonChange={onChange}\n\t\t\t\t\t\tallowedFormats={[]}\n\t\t\t\t\t\tkeepPlaceholderOnFocus\n\t\t\t\t\t\tvalue={doiCitation}\n\t\t\t\t\t\tplaceholder={'Citation ID Here...'}\n\t\t\t\t\t\tdisableLineBreaks\n\t\t\t\t\t\t__unstableOnSplitAtEnd={() =>\n\t\t\t\t\t\t\tinsertBlocksAfter(createBlock(getDefaultBlockName()))\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tvalue={doiCitation}\n\t\t\t\t\t\tonChange={onChange}\n\t\t\t\t\t/>\n\t\t\t\t)\n\t\t\t)}\n\t\t</p>\n\t);\n}\n\nexport { extractDoiCitation, Citation };\n\nexport default Citation;","/**\n * External Dependencies\n */\nimport { MediaDropZone } from '@prc/components';\nimport { useDebounce } from '@prc/hooks';\n\n/**\n * WordPress Dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState } from '@wordpress/element';\nimport { PanelBody, TextareaControl, CardDivider } from '@wordpress/components';\n\n/**\n * Internal Dependencies\n */\nimport { Citation, extractDoiCitation } from '../../../shared/citation';\n\nconst ALLOWED_TYPES = ['application/json'];\n\nexport default function DataciteDOISchemaPanel({\n\tmeta,\n\tsetMeta,\n\tpostTitle,\n\tpostDate,\n}) {\n\tconst [dataciteDoi, setDataciteDoi] = useState(meta.datacite_doi || '');\n\tconst debouncedDataciteDoi = useDebounce(dataciteDoi, 500);\n\n\tconst [dataciteDoiCitation, setDataciteDoiCitation] = useState(\n\t\tmeta.datacite_doi_citation || ''\n\t);\n\tconst debouncedDataciteDoiCitation = useDebounce(dataciteDoiCitation, 500);\n\n\tuseEffect(() => {\n\t\tconst payload = {\n\t\t\t...meta,\n\t\t};\n\t\tlet extractedCitation = null;\n\t\t// Quick diff check to avoid unnecessary updates\n\t\tif (debouncedDataciteDoi !== meta.datacite_doi) {\n\t\t\tpayload.datacite_doi = debouncedDataciteDoi;\n\t\t\tconsole.log('debouncedDataciteDoi', debouncedDataciteDoi);\n\t\t\textractedCitation = extractDoiCitation(debouncedDataciteDoi);\n\t\t}\n\t\tif (debouncedDataciteDoiCitation !== meta.datacite_doi_citation) {\n\t\t\tpayload.datacite_doi_citation = debouncedDataciteDoiCitation;\n\t\t}\n\t\t// This ensures the citation id always matches the DOI data.\n\t\tif (\n\t\t\textractedCitation &&\n\t\t\textractedCitation !== payload.datacite_doi_citation\n\t\t) {\n\t\t\tpayload.datacite_doi_citation = extractedCitation;\n\t\t\tsetDataciteDoiCitation(extractedCitation);\n\t\t}\n\t\tsetMeta(payload);\n\t}, [debouncedDataciteDoi, debouncedDataciteDoiCitation]);\n\n\treturn (\n\t\t<PanelBody title={__('DataCite DOI Schema')}>\n\t\t\t<TextareaControl\n\t\t\t\tlabel={__('DataCite DOI Schema')}\n\t\t\t\thelp={__('Enter the DataCite DOI schema as JSON')}\n\t\t\t\tvalue={dataciteDoi}\n\t\t\t\tonChange={(value) => {\n\t\t\t\t\tsetDataciteDoi(value);\n\t\t\t\t}}\n\t\t\t\trows={10}\n\t\t\t/>\n\t\t\t<CardDivider />\n\t\t\t<Citation\n\t\t\t\tdate={postDate}\n\t\t\t\ttitle={postTitle}\n\t\t\t\tdoiCitation={dataciteDoiCitation}\n\t\t\t\tallowEditing={true}\n\t\t\t\tonChange={(value) => {\n\t\t\t\t\tsetDataciteDoiCitation(value);\n\t\t\t\t}}\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"prcIcons\"];","import { Icon as IconRenderer } from '@prc/icons';\n\nconst Icon = () => {\n\treturn <IconRenderer icon=\"fingerprint\" library=\"light\" size={'1.2'} />;\n};\n\nexport default Icon;\n","/**\n * External Dependencies\n */\n\n/**\n * WordPress Dependencies\n */\nimport { registerPlugin } from '@wordpress/plugins';\nimport {\n\tPluginSidebar,\n\tPluginSidebarMoreMenuItem,\n\tstore as editorStore,\n} from '@wordpress/editor';\nimport { useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { useEntityProp } from '@wordpress/core-data';\nimport { __ } from '@wordpress/i18n';\nimport { PanelRow } from '@wordpress/components';\n\n/**\n * Internal Dependencies\n */\nimport DataciteDOISchemaPanel from './datacite-doi-schema-panel';\nimport Icon from '../../../shared/icon';\n\nconst PLUGIN_NAME = 'prc-schema-academic-identity-panel';\n\nconst Panel = () => {\n\tconst { postType, postId } = useSelect((select) => {\n\t\tconst currentPostType = select(editorStore).getCurrentPostType();\n\t\tconst currentPostId = select(editorStore).getCurrentPostId();\n\t\treturn {\n\t\t\tpostType: currentPostType,\n\t\t\tpostId: currentPostId,\n\t\t};\n\t}, []);\n\tconst [postTitle] = useEntityProp('postType', postType, 'title', postId);\n\tconst [postDate] = useEntityProp('postType', postType, 'date', postId);\n\tconst [meta, setMeta] = useEntityProp('postType', postType, 'meta', postId);\n\tconst date = useMemo(() => {\n\t\treturn new Date(postDate || null).getFullYear();\n\t}, [postDate]);\n\n\treturn (\n\t\t<>\n\t\t\t<PluginSidebarMoreMenuItem target={PLUGIN_NAME} icon={<Icon />}>\n\t\t\t\t{__('Academic Identity')}\n\t\t\t</PluginSidebarMoreMenuItem>\n\t\t\t<PluginSidebar\n\t\t\t\tname={PLUGIN_NAME}\n\t\t\t\ttitle=\"Academic Identity\"\n\t\t\t\ticon={<Icon />}\n\t\t\t>\n\t\t\t\t<PanelRow>\n\t\t\t\t\t<p style={{ padding: '1em' }}>\n\t\t\t\t\t\tThe Academic Identity plugin supports our commitment to\n\t\t\t\t\t\topen science and data accessibility. For details about\n\t\t\t\t\t\tour \"Open Science\" initiative, visit the{' '}\n\t\t\t\t\t\t<a href=\"https://platform.pewresearch.org/wiki/open-science\">\n\t\t\t\t\t\t\tWiki\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t.\n\t\t\t\t\t</p>\n\t\t\t\t</PanelRow>\n\t\t\t\t<DataciteDOISchemaPanel\n\t\t\t\t\tmeta={meta}\n\t\t\t\t\tsetMeta={setMeta}\n\t\t\t\t\tpostTitle={postTitle}\n\t\t\t\t\tpostDate={date}\n\t\t\t\t/>\n\t\t\t</PluginSidebar>\n\t\t</>\n\t);\n};\n\nregisterPlugin(PLUGIN_NAME, {\n\ticon: <Icon />,\n\trender: () => <Panel />,\n});\n"],"names":["window","DOI_CITATION_REGEX","Citation","date","title","doiCitation","allowEditing","editingAsRichText","onChange","t","sprintf","_jsxs","children","_jsx","RichText","tagName","allowedFormats","keepPlaceholderOnFocus","value","placeholder","disableLineBreaks","__unstableOnSplitAtEnd","insertBlocksAfter","createBlock","getDefaultBlockName","TextControl","href","DataciteDOISchemaPanel","meta","setMeta","postTitle","postDate","dataciteDoi","setDataciteDoi","useState","datacite_doi","debouncedDataciteDoi","useDebounce","dataciteDoiCitation","setDataciteDoiCitation","datacite_doi_citation","debouncedDataciteDoiCitation","useEffect","payload","extractedCitation","console","log","str","JSON","parse","e","isValidJSON","warn","error","test","match","data","id","extractDoiCitation","PanelBody","__","TextareaControl","label","help","rows","CardDivider","Icon","IconRenderer","icon","library","size","PLUGIN_NAME","Panel","postType","postId","useSelect","select","editorStore","getCurrentPostType","getCurrentPostId","useEntityProp","useMemo","Date","getFullYear","_Fragment","PluginSidebarMoreMenuItem","target","PluginSidebar","name","PanelRow","style","padding","registerPlugin","render"],"sourceRoot":""}