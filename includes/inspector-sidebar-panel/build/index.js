(()=>{"use strict";const e=window.wp.plugins,t=window.wp.editor,i=window.wp.element,n=window.wp.data,o=window.wp.coreData,a=window.wp.i18n,s=window.wp.components,d=(window.prcComponents,window.prcHooks),r=window.wp.blockEditor,c=window.wp.blocks,l=window.ReactJSXRuntime,p=/(https:\/\/doi\.org\/)?(\d{2}\.\d{5}\/[A-Za-z0-9-]+)/;function u({date:e="2025",title:t="Title of the Article",doiCitation:i="XX.XXX/XXXXX",allowEditing:n=!1,editingAsRichText:o=!1,onChange:d=()=>{}}){const p=(0,a.sprintf)('"%s."',t);return(0,l.jsxs)("p",{children:[(0,l.jsxs)("span",{children:["Doe, John. ",e,". ",p," Pew Research Center. doi:"]})," ",n?o?(0,l.jsx)(r.RichText,{tagName:"span",onChange:d,allowedFormats:[],keepPlaceholderOnFocus:!0,value:i,placeholder:"Citation ID Here...",disableLineBreaks:!0,__unstableOnSplitAtEnd:()=>insertBlocksAfter((0,c.createBlock)((0,c.getDefaultBlockName)()))}):(0,l.jsx)(s.TextControl,{value:i,onChange:d}):(0,l.jsx)("span",{children:(0,l.jsx)("a",{href:`https://doi.org/${i}`,children:i})})]})}function w({meta:e,setMeta:t,postTitle:n,postDate:o}){const[r,c]=(0,i.useState)(e.datacite_doi||""),w=(0,d.useDebounce)(r,500),[h,g]=(0,i.useState)(e.datacite_doi_citation||""),m=(0,d.useDebounce)(h,500);return(0,i.useEffect)(()=>{const i={...e};let n=null;w!==e.datacite_doi&&(i.datacite_doi=w,console.log("debouncedDataciteDoi",w),n=(e=>{if(console.log("extractedCitation in:",e),!e||"string"!=typeof e||!(e=>{try{return JSON.parse(e),!0}catch(e){return!1}})(e))return console.warn("Invalid JSON provided for DOI citation"),null;try{e=JSON.parse(e)}catch(e){return console.error("Failed to parse DOI JSON:",e),null}return console.log("passed...",e),e&&e["@id"]&&p.test(e["@id"])?e["@id"].match(p)[2]:(console.log("passed...",e.data),e&&e.data.id&&p.test(e.data.id)?e.data.id.match(p)[2]:null)})(w)),m!==e.datacite_doi_citation&&(i.datacite_doi_citation=m),n&&n!==i.datacite_doi_citation&&(i.datacite_doi_citation=n,g(n)),t(i)},[w,m]),(0,l.jsxs)(s.PanelBody,{title:(0,a.__)("DataCite DOI Schema"),children:[(0,l.jsx)(s.TextareaControl,{label:(0,a.__)("DataCite DOI Schema"),help:(0,a.__)("Enter the DataCite DOI schema as JSON"),value:r,onChange:e=>{c(e)},rows:10}),(0,l.jsx)(s.CardDivider,{}),(0,l.jsx)(u,{date:o,title:n,doiCitation:h,allowEditing:!0,onChange:e=>{g(e)}})]})}const h=window.prcIcons,g=()=>(0,l.jsx)(h.Icon,{icon:"fingerprint",library:"light",size:"1.2"}),m="prc-schema-academic-identity-panel",x=()=>{const{postType:e,postId:d}=(0,n.useSelect)(e=>({postType:e(t.store).getCurrentPostType(),postId:e(t.store).getCurrentPostId()}),[]),[r]=(0,o.useEntityProp)("postType",e,"title",d),[c]=(0,o.useEntityProp)("postType",e,"date",d),[p,u]=(0,o.useEntityProp)("postType",e,"meta",d),h=(0,i.useMemo)(()=>new Date(c||null).getFullYear(),[c]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.PluginSidebarMoreMenuItem,{target:m,icon:(0,l.jsx)(g,{}),children:(0,a.__)("Academic Identity")}),(0,l.jsxs)(t.PluginSidebar,{name:m,title:"Academic Identity",icon:(0,l.jsx)(g,{}),children:[(0,l.jsx)(s.PanelRow,{children:(0,l.jsxs)("p",{style:{padding:"1em"},children:['The Academic Identity plugin supports our commitment to open science and data accessibility. For details about our "Open Science" initiative, visit the'," ",(0,l.jsx)("a",{href:"https://platform.pewresearch.org/wiki/open-science",children:"Wiki"}),"."]})}),(0,l.jsx)(w,{meta:p,setMeta:u,postTitle:r,postDate:h})]})]})};(0,e.registerPlugin)(m,{icon:(0,l.jsx)(g,{}),render:()=>(0,l.jsx)(x,{})})})();
//# sourceMappingURL=index.js.map